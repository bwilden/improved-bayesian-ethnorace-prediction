---
title: "Improved Bayesian Ethnorace Prediction"
author: "Bertrand Wilden"
date: "Last updated on `r format(Sys.time(), '%d %B, %Y')`"
output:
  pdf_document: default
header-includes:
- \usepackage{setspace}\doublespacing
- \usepackage{amsmath, physics}
- \usepackage{floatrow} \floatsetup[figure]{capposition=top}
indent: yes
fontsize: 11pt
bibliography: bibli.json
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE, cache.lazy = FALSE)
```

```{r libraries}
library(tidyverse)
library(ggthemes)
library(gridExtra)
library(here)
```

# Abstract

```{=tex}
\begin{singlespace}
Quantitative social science research on race and ethnicity can be constrained by the lack of available individual-level data with these markers. In response to this issue, methods have been developed to predict individuals' race and ethnicity using Bayes' rule. Racial distributions from the US Census Surname List are combined with distributions from geolocations, such as Census blocks or zip codes, to yield predicted probabilities of individuals' race and ethnicity. I expand upon existing methods by incorporating information from a nationwide list of first names as well as from residence characteristics. Along with some other adjustments, these improvements lead to substantial gains in predictive performance when validated against official state voter files. The largest of these predictive gains are found for African Americans and Hispanics---groups which existing methods find difficult to predict accurately without fine-grain geolocation information.
\end{singlespace}
```
# Introduction

Research on racial and ethnic disparities in the United States can be constrained by the lack of available individual-level data with these markers [@cascio2012; @kuk2020]. This is particularly true when racial geography is a key aspect of the research design. In these contexts, researchers are often forced to use aggregate-level data on group proportions, such as county statistics, to draw inferences. But this method is susceptible to the modifiable areal unit problem, whereby statistical bias is introduced due to arbitrary and unequal geographic unit sizes [@fotheringham1991]. Furthermore, some research designs all but require individual-level data. Geographic regression discontinuity designs---an increasingly common causal inference technique---typically relies on individually geocoded addresses [@keele2018; @velez2019; @cantoni2020]. Therefore if race or ethnicity is a central element of the research question, individual-level identifiers for these categories are likely necessary.

To overcome some of these challenges, in this paper I describe a method for imputing individual ethnorace categories directly. This method uses Bayes' rule to make predictions by combining information from nationwide distributions of six ethnoracial categories over other characteristics, such as names, geographies, political party identification, among others. My implementation builds off existing methods which use a similar formula [@elliott2009; @imai2016; @voicu2018]. The method described in Imai and Khanna (2016) in particular, and the associated `R` package `wru`, has become popular in recent studies on race and ethnicity. Its application has been used in work on racial protests and voting patterns [@enos2019], disparities in campaign financing [@grumbach2020; @grumbach2020a], and public health issues such as suicide rates [@studdert2020].

My ethnorace prediction method improves upon Imai and Khanna (2016) in several ways. Whereas their method only takes as inputs distributions over surnames, geolocation, political party, age, and gender, my version adds information from a nationwide list of first names [@tzioumis2018] as well as address characteristics. Additionally, I incorporate insights from the machine learning literature on the Naive Bayes algorithm. The result of these modifications is a substantial increase in predictive performance compared to Imai and Khanna (2016) in validation tests. These predictive gains are particularly strong in regards to correctly classifying African American and Hispanic individuals---especially in contexts where fine-grain geolocation data are unavailable. My method is available in an easy-to-use `R` package `bper`.[^1]

[^1]: `bper`: Bayesian Prediction for Ethnicity and Race. <https://github.com/bwilden/bper>

In the next section I will provide some background on the inputs and outputs of my prediction method. Then I will explain the methodology and compare my implementation with previous versions. Finally, I will demonstrate the predictive performance of my method when validated against the combined North Carolina and Florida voter file ($n$ = 21,000,000).

# Data

## Outputs

Before discussing the methodology further, it is important to first define what "predicting ethnicity or race" means. These are categories which, although relatively immutable compared to other identities, do not have universally accepted delineations and meanings [@omi2014]. I follow the convention from previous ethnorace prediction methods by using the US Census Bureau categorizations [@elliott2009; @imai2016; @voicu2018]. In this framework, individuals can be classified as non-Hispanic White, non-Hispanic Black or African American, non-Hispanic Asian and Pacific Islander, non-Hispanic American Indian and Alaska Native, Hispanic or Latino alone, and non-Hispanic Other Race.[^2] Because Hispanic identity is defined by the Census, and understood commonly, as an ethnicity, rather than a race, I use the term "ethnorace" in this paper to refer to any of the previously-mentioned categories. 

[^2]: Non-Hispanic Other Race includes individuals who identify as belonging to two or more race/ethnicities, or mixed race, as well as those who may not identify with the other Census categories. 

There are a few benefits to using the Census ethnoracial categorization. These groups capture a common understanding of race and ethnicity in the US, and correspond to the groups studied most frequently in social science research. The data sources of these groups' distributions that serve as inputs to the prediction formula rely on the Census categorization. This also facilitates comparison of my method against previous ethnorace prediction methods.[^3] One downside to using the Census categories, however, is that it obscures substantial heterogeneity that may exist within each group. Within Asian Americans and Latinos, for example, there is considerable variation in terms of national ancestry. Furthermore, the unfortunate necessity of an Other Race category ensures that important sources of diversity are washed over.[^4]

[^3]: Unlike my method, Imai and Khanna (2016) do not include a separate category for American Indian and Alaska Native. In order to create similar comparison groups, I recode all predicted American Indian and Alaska Native individuals as Other Race during the validation exercises. If desired, however, the `bper` package will produce predicted probabilities for the American Indian and Alaska Native category.

[^4]: This is hinted at empirically by the method's abysmal predictive performance for the Other Race category.

## Inputs



### First Names

The first names list I use comes from Tzioumis (2017). It is drawn from mortgage applicants and contains ethnorace counts in each of the six categories across 4,250 first names. Unlike Census data, which form the basis for much of my other data sources, this list of first names may be unrepresentative of the larger US population. To the extent that first name distributions differ by ethnorace given employment status, for example, this may be a concern. But the predictive benefits from using first name data, as I will demonstrate, likely overwhelms these worries in most contexts.

### Last Names

For my last names data, I use the 2010 Census Surnames List.[^5] This list comes from the 2010 decennial Census and contains over 160,000 common US last names (those occurring 100 or more times). Like the first names list, these data include counts of individuals in each of the six ethnorace categories across each last name.

[^5]: <https://www.census.gov/topics/population/genealogy/data/2010_surnames.html>

### Geolocations

My ethnorace distributions by geographies come from the 2010 decennial Census, accessed via IPUMS NHGIS.[^6] In descending order of mean population, these geographies include *state*, *county*, *Census place*, *ZIP code*, and *Census block*. Predictions tend to improve with more precise levels of geography. With this in mind, my implementation automatically matches each individual to the most fine-grain level of geography available. It is worth pointing out that this phenomenon is, in part, the consequence of generations of segregationist housing policies in the US. The fact that knowing an individual's ZIP code or Census block gives us so much knowledge about their race is an indictment of the US system more generally.

[^6]: Steven Manson, Jonathan Schroeder, David Van Riper, Tracy Kugler, and Steven Ruggles. IPUMS National Historical Geographic Information System: Version 15.0 [dataset]. Minneapolis, MN: IPUMS. 2020. http://doi.org/10.18128/D050.V15.0

### Party Identification

My party identification data come from a 2012 Gallup poll.[^7] The three categories of political party I include are Republican, Democrat, and Other (including independents and "don't knows"). 

[^7]: <https://news.gallup.com/poll/160373/democrats-racially-diverse-republicans-mostly-white.aspx>

### Age and Gender

Like my geolocation data, age and gender distributions come from the 2010 decennial Census, accessed via IPUMS NHGIS. These variables do not contain much predictive power in terms of ethnoracial classification, but nevertheless, I find that their inclusion in the formula helps slightly.

### Multi-unit Address

These data refer to ethnorace distributions over multi-unit housing occupancy. Individuals are matched to these probabilities if their address contains "Apt", "Unit", "#", or other such identifier. Unfortunately, I was not able to find these distributions for the 2010 decennial Census, so instead I use those from the year 2000. 

# Methodology

In general terms, the method described here computes predicted probabilities for each of the six aforementioned ethnorace categories for each individual. Then, each individual is classified into the category corresponding to the highest predicted probability. These predicted probabilities can be stated more formally as the conditional probability of identifying as a particular ethnorace for an individual with a particular profile of first name, last name, geolocation, party ID, age, gender, and address type. Bayes' rule provides a template for how to answer this sort of conditional probability problem.

\begin{equation}
Pr(R=r|X) = \frac{Pr(X|R=r)Pr(R=r)}{Pr(X)}
\end{equation}

Where $R$ is an individual's true ethnorace, $r$ is one of six possible ethnorace categories (White, Black, Asian, Native American, Hispanic, or Other race), and $X$ is the joint probability of an individual having a particular profile of attributes (first name, last name, geolocation, party ID, age, gender, and address type). Unfortunately, the joint probability $X$ in Equation is intractable due to both data constraints and the astronomically large number of combinations of possible attribute profiles. If however, we assume conditional independence of ethnorace among each attribute in $X$, we can rewrite Equation (1) in terms of less complex conditional probabilities:

\begin{equation}
Pr(R=r|X) = \frac{Pr(R=r|x')\prod\limits_{j=1}^6Pr(x_j|R=r)}{\sum\limits_{i=1}^{6} Pr(R=r_i|x')\prod\limits_{j=1}^6Pr(x_j|R=r_i)}
\end{equation}

Where $x$ is the vector of individual attributes indexed by $j$. The particular attribute $x'$ comes from the use of the chain rule when decomposing the joint probability $Pr(R=r, X)$. The choice of which attribute to use for $x'$ is atheoretical, but all previous prediction methods have used last names [@elliott2009; @imai2016; @voicu2018]. During my validation exercises, I found that the choice of $x'$ has potentially large consequences for predictive performance. Using last names for $x'$ appears to help predictions of Whites---but to the detriment of other categories. In light of these trade-offs, my method cycles through every attribute as the choice of $x'$ and computes $Pr(R=r|X)$ for each. These posterior probabilities are then averaged within each ethnorace to generate final predicted probabilities that an individual belongs to a particular ethnorace. The end result is more balanced predictions across each ethnorace category.

The conditional independence assumption necessary for transforming (1) to (2) means that knowing both a particular attribute, and an individual's ethnorace, should give us no extra knowledge of any other attribute for that individual. Stated formally, $Pr(x_j|R=r,X) = Pr(x_j|R=r)$ for all $x_j$. This assumption is almost certainly violated in the present context. One example that has been demonstrated empirically is that last name distributions by race vary across regions in the US [@crabtree2018]. 

Violations of the conditional independence assumption are commonplace in most applications of similar classification algorithms. Nevertheless, these prediction methods perform unreasonably well in many contexts [@lewis1998; @domingos1997; @rish2001]. This is likely because 


# Validation




# Conclusion

cite list:

methods:

-   [@voicu2018]

-   [@tzioumis2018]

-   [@shah2017]

-   [@imai2016]

-   [@elliott2009]

-   [@crabtree2018] (independence assumption)

-   [@lauderdale2000] (asian surnames)

naive bayes:

-   [@rish2001]

-   [@lewis1998]

-   [@domingos1997]

applications:

-   [@velez2019] (use NC)

-   [@studdert2020] (medical study)

-   [@kuk2020] (aggregate)

-   [@cascio2012] (aggregate)

-   [@cantoni2020] (RDD)

-   [@hersh2016] (catalist)

-   [@ghitza] (catalist)

-   [@grumbach2020]

-   [@grumbach2020a]

-   [@fraga2018] (turnout)

-   [@enos2019] (protests and voting)

-   [@enos2016] (racial threat)

race:

-   [@omi2014]

## References
